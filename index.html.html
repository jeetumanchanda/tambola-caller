<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambola / Housie Caller</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#ffb703;
    --cell-bg:#0f1724;
    --cell-border: rgba(255,255,255,0.06);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background: linear-gradient(180deg,#071023 0%, #072035 50%, #051428 100%);
    color:#e6eef8;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
  }
  .container{
    width:100%;
    max-width:1100px;
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:20px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  }
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
  h1{font-size:20px;margin:0;letter-spacing:0.6px;}
  .controls{display:flex;gap:12px;align-items:center;}
  .info{font-size:13px;color:rgba(230,238,248,0.78)}

  /* Board */
  .board{
    display:grid;
    grid-template-columns:repeat(9,1fr);
    gap:10px;
    padding:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border-radius:10px;
    margin-bottom:16px;
  }
  .cell{
    position:relative;
    aspect-ratio:1/1;
    min-height:48px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:8px;
    font-weight:600;
    color: #eaf3ff;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    border:1px solid var(--cell-border);
    transition:transform .15s ease, box-shadow .15s ease;
    user-select:none;
  }
  .cell:hover{transform:translateY(-4px)}

  /* colourful numbers: give columns different subtle tints */
  .cell[data-col="1"]{background: linear-gradient(180deg,#2a3d6b22,#10223a22);}
  .cell[data-col="2"]{background: linear-gradient(180deg,#3b5a3b22,#0b2b1a22);}
  .cell[data-col="3"]{background: linear-gradient(180deg,#4b2a5f22,#200b2b22);}
  .cell[data-col="4"]{background: linear-gradient(180deg,#5a3d2a22,#2b170b22);}
  .cell[data-col="5"]{background: linear-gradient(180deg,#2a5a5a22,#07272722);}
  .cell[data-col="6"]{background: linear-gradient(180deg,#3b3b5a22,#0b0b2b22);}
  .cell[data-col="7"]{background: linear-gradient(180deg,#5a2a2a22,#2b0b0b22);}
  .cell[data-col="8"]{background: linear-gradient(180deg,#2a2a5a22,#0b0b2b22);}
  .cell[data-col="9"]{background: linear-gradient(180deg,#3a2a5a22,#120b2b22);}

  /* called style - red circle */
  .cell.called::after{
    content:"";
    position:absolute;
    inset:6px;
    border-radius:50%;
    border:6px solid rgba(220,38,38,0.95);
    box-shadow:0 6px 18px rgba(220,38,38,0.12), inset 0 8px 22px rgba(255,80,80,0.06);
    pointer-events:none;
  }
  .cell span{position:relative;z-index:2;font-size:14px}
  .top-row{display:flex;gap:10px;align-items:center;margin-bottom:8px;flex-wrap:wrap}

  /* bell button (SVG inside) */
  .bell-wrap{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .bell-btn{
    width:72px;
    height:72px;
    border-radius:14px;
    display:grid;
    place-items:center;
    background: linear-gradient(180deg,#ffd27f,#ffb703);
    box-shadow: 0 6px 18px rgba(255,183,3,0.2), inset 0 -6px 16px rgba(0,0,0,0.12);
    border:none;
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease;
    padding:10px;
  }
  .bell-btn:active{transform:translateY(2px) scale(.99)}
  .bell-svg{width:44px;height:44px;display:block}
  .reset-btn, .download-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:inherit;
    padding:8px 12px;border-radius:8px;
    cursor:pointer;
    font-size:13px;
  }
  .reset-btn:disabled{opacity:0.45;cursor:not-allowed}

  /* overlay called number */
  .overlay{
    position:fixed;left:0;top:0;right:0;bottom:0;
    display:grid;place-items:center;
    background:rgba(5,7,12,0.6);
    z-index:60;
    backdrop-filter: blur(6px);
    opacity:0;pointer-events:none;transition:opacity .18s ease;
  }
  .overlay.show{opacity:1;pointer-events:auto}
  .bignum{
    width:320px;height:320px;border-radius:50%;
    display:grid;place-items:center;
    background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.06), rgba(0,0,0,0.2)), linear-gradient(180deg,#ffefdb,#ffd27f);
    box-shadow: 0 30px 80px rgba(0,0,0,0.5), 0 8px 30px rgba(255,183,3,0.12);
    font-size:120px;font-weight:800;color:#2b1000;
    transform:scale(.6);
    animation:pop .45s cubic-bezier(.2,.9,.22,1);
  }
  @keyframes pop{from{transform:scale(.4) rotate(-8deg)} to{transform:scale(1) rotate(0)}}

  .status{font-size:13px;color:rgba(230,238,248,0.68)}

  footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-size:13px;color:rgba(230,238,248,0.6)}

  /* small responsive tweaks */
  @media (max-width:720px){
    .bignum{width:220px;height:220px;font-size:84px}
    .bell-btn{width:62px;height:62px}
  }
</style>
</head>
<body>
<div class="container" role="application" aria-label="Tambola caller">
  <header>
    <h1>Tambola / Housie Caller — 1 to 90</h1>
    <div class="controls">
      <div class="info">Called: <span id="calledCount">0</span>/90</div>
      <div class="bell-wrap">
        <button id="bell" class="bell-btn" title="Call next number" aria-label="Call next number">
          <!-- Bell-shaped SVG (button looks like bell) -->
          <svg class="bell-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
            <path d="M12 2C10.3431 2 9 3.34315 9 5V6.089C6.16344 7.0812 4 9.88051 4 13V17L2 19V20H22V19L20 17V13C20 9.88051 17.8366 7.0812 15 6.089V5C15 3.34315 13.6569 2 12 2Z" stroke="#6b2b00" stroke-width="0.6" fill="#fff9f0"/>
            <path d="M10 21C10 21.5523 10.4477 22 11 22H13C13.5523 22 14 21.5523 14 21" stroke="#6b2b00" stroke-width="0.6" fill="none"/>
          </svg>
        </button>
        <button id="reset" class="reset-btn" title="Reset session">Reset</button>
        <button id="download" class="download-btn" title="Download as HTML file">Download HTML</button>
      </div>
    </div>
  </header>

  <main>
    <div id="board" class="board" aria-live="polite" role="grid" aria-label="Tambola board with numbers">
      <!-- cells will be injected by JS -->
    </div>

    <footer>
      <div class="status" id="lastCalled">Last called: —</div>
      <div class="status">Tip: Click the bell or press <strong>Space</strong></div>
    </footer>
  </main>
</div>

<!-- overlay to display called number big for 5s -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="bignum" id="bignum" role="status" aria-live="assertive">0</div>
</div>

<script>
(function(){
  const board = document.getElementById('board');
  const calledCountEl = document.getElementById('calledCount');
  const lastCalledEl = document.getElementById('lastCalled');
  const overlay = document.getElementById('overlay');
  const bignum = document.getElementById('bignum');
  const bell = document.getElementById('bell');
  const resetBtn = document.getElementById('reset');
  const downloadBtn = document.getElementById('download');

  // Create 1..90 cells in 9 columns x 10 rows
  for(let i=1;i<=90;i++){
    const col = ((i-1)%9)+1; // 1..9
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.setAttribute('data-number', i);
    cell.setAttribute('data-col', col);
    cell.setAttribute('role','gridcell');
    const span = document.createElement('span');
    span.textContent = i;
    cell.appendChild(span);
    board.appendChild(cell);
  }

  let called = new Set();
  let available = Array.from({length:90}, (_,i)=>i+1);

  function pickRandom(){
    if(available.length===0) return null;
    const idx = Math.floor(Math.random()*available.length);
    const num = available.splice(idx,1)[0];
    called.add(num);
    return num;
  }

  function markNumber(num){
    const sel = board.querySelector('.cell[data-number=\"'+num+'\"]');
    if(sel) sel.classList.add('called');
  }

  function showOverlay(num){
    bignum.textContent = num;
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
    // hide after 5 seconds
    setTimeout(()=>{
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
    },5000);
  }

  function updateStatus(num){
    calledCountEl.textContent = called.size;
    lastCalledEl.textContent = num ? 'Last called: ' + num : 'Last called: —';
    if(available.length===0){
      bell.disabled = true;
      bell.title = 'All numbers called';
      bell.style.opacity = '0.45';
    }
  }

  function callNext(){
    if(available.length===0) return;
    const n = pickRandom();
    if(n===null) return;
    markNumber(n);
    showOverlay(n);
    updateStatus(n);
    // small accessibility announcement
    setTimeout(()=>{
      const a = document.createElement('span');
      a.setAttribute('aria-live','polite');
      a.style.position = 'absolute';
      a.style.left='-9999px';
      a.textContent = 'Number ' + n + ' called.';
      document.body.appendChild(a);
      setTimeout(()=>document.body.removeChild(a),1200);
    },120);
  }

  // click handlers
  bell.addEventListener('click', callNext);
  resetBtn.addEventListener('click', ()=>{
    // reset state
    called.clear();
    available = Array.from({length:90}, (_,i)=>i+1);
    // clear marks
    board.querySelectorAll('.cell.called').forEach(c=>c.classList.remove('called'));
    bell.disabled = false;
    bell.style.opacity = '1';
    updateStatus(null);
  });

  // space key to call
  document.addEventListener('keydown', (e)=>{
    if(e.code==='Space' && !e.repeat){
      e.preventDefault();
      if(!bell.disabled) callNext();
    }
  });

  // overlay click hides immediately
  overlay.addEventListener('click', ()=>{
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
  });

  // Download current HTML file (generate a blob of the same source)
  downloadBtn.addEventListener('click', ()=>{
    const html = `<!doctype html>\n${document.documentElement.outerHTML}`;
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'tambola_caller.html';
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); document.body.removeChild(a); }, 1500);
  });

  // Optional: keyboard shortcut 'r' to reset
  document.addEventListener('keydown', (e)=>{
    if(e.key==='r' || e.key==='R') resetBtn.click();
  });

  // initial status
  updateStatus(null);

})();</script>
</body>
</html>
